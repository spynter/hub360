{"ast":null,"code":"var _jsxFileName = \"D:\\\\respaldo jose\\\\PROJECTS_V0\\\\hub360\\\\frontend\\\\src\\\\components\\\\Editor\\\\TourEditor.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport SceneManager from './SceneManager';\nimport HotspotEditor from './HotspotEditor';\nimport api from '../../services/api';\nimport DragDrop from './DragDrop';\nimport './TourEditor.css';\n\n// Utilidad para obtener la URL absoluta de la imagen\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction getAbsoluteImageUrl(image) {\n  if (!image) return '';\n  if (image.startsWith('/uploads/')) {\n    var _process$env$REACT_AP;\n    return `${((_process$env$REACT_AP = process.env.REACT_APP_API_URL) === null || _process$env$REACT_AP === void 0 ? void 0 : _process$env$REACT_AP.replace('/api', '')) || 'http://localhost:5000'}${image}`;\n  }\n  return image;\n}\nfunction TourEditor({\n  tourId\n}) {\n  _s();\n  const containerRef = useRef();\n  const [tour, setTour] = useState(null);\n  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);\n  const [selectedHotspot, setSelectedHotspot] = useState(null);\n  const [isAddingHotspot, setIsAddingHotspot] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [panelOpen, setPanelOpen] = useState(true);\n\n  // Referencias de Three.js\n  const sceneRef = useRef();\n  const cameraRef = useRef();\n  const rendererRef = useRef();\n  const controlsRef = useRef();\n\n  // Nuevo: Estado para guardar la posición del click en la esfera\n  const [pendingHotspot, setPendingHotspot] = useState(null);\n\n  // Cargar tour desde la API\n  useEffect(() => {\n    const fetchTour = async () => {\n      try {\n        const response = await api.getTour(tourId);\n        setTour(response.data);\n        setLoading(false);\n      } catch (err) {\n        setError('Error al cargar el tour');\n        setLoading(false);\n        console.error(err);\n      }\n    };\n    fetchTour();\n  }, [tourId]);\n\n  // Inicializar Three.js\n  useEffect(() => {\n    if (!tour || loading) return;\n\n    // Limpiar canvas anterior si existe\n    if (rendererRef.current && rendererRef.current.domElement && containerRef.current) {\n      if (containerRef.current.contains(rendererRef.current.domElement)) {\n        containerRef.current.removeChild(rendererRef.current.domElement);\n      }\n      rendererRef.current.dispose();\n    }\n\n    // Eliminar cualquier canvas sobrante (por si acaso)\n    if (containerRef.current) {\n      while (containerRef.current.firstChild) {\n        containerRef.current.removeChild(containerRef.current.firstChild);\n      }\n    }\n\n    // Usar el tamaño del contenedor para el renderer\n    const width = containerRef.current.clientWidth || window.innerWidth;\n    const height = containerRef.current.clientHeight || window.innerHeight;\n    const scene = new THREE.Scene();\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\n    camera.position.set(0, 0, 0.1);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(width, height);\n    renderer.setClearColor(0x22232a, 1); // Fondo oscuro, pero no negro puro\n    containerRef.current.appendChild(renderer.domElement);\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controls.rotateSpeed = 0.5;\n    sceneRef.current = scene;\n    cameraRef.current = camera;\n    rendererRef.current = renderer;\n    controlsRef.current = controls;\n    let animationId;\n    const animate = () => {\n      animationId = requestAnimationFrame(animate);\n      controls.update();\n      renderer.render(scene, camera);\n    };\n    animate();\n\n    // Responsivo al tamaño del contenedor\n    const handleResize = () => {\n      if (!containerRef.current) return;\n      const w = containerRef.current.clientWidth || window.innerWidth;\n      const h = containerRef.current.clientHeight || window.innerHeight;\n      camera.aspect = w / h;\n      camera.updateProjectionMatrix();\n      renderer.setSize(w, h);\n    };\n    window.addEventListener('resize', handleResize);\n\n    // Limpieza\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (animationId) cancelAnimationFrame(animationId);\n      if (rendererRef.current && rendererRef.current.domElement && containerRef.current && containerRef.current.contains(rendererRef.current.domElement)) {\n        rendererRef.current.dispose();\n        containerRef.current.removeChild(rendererRef.current.domElement);\n      }\n    };\n  }, [tour, loading]);\n\n  // Cargar la escena current\n  useEffect(() => {\n    if (!tour || !sceneRef.current || !tour.scenes || !Array.isArray(tour.scenes) || tour.scenes.length === 0 || currentSceneIndex === -1 || !tour.scenes[currentSceneIndex]) return;\n    const scene = sceneRef.current;\n    const currentScene = tour.scenes[currentSceneIndex];\n\n    // Limpiar escena anterior\n    while (scene.children.length > 0) {\n      scene.remove(scene.children[0]);\n    }\n\n    // Crear esfera para la imagen 360 con mayor calidad visual\n    const geometry = new THREE.SphereGeometry(500, 128, 96); // Más segmentos para suavidad\n    geometry.scale(-1, 1, 1);\n    const textureLoader = new THREE.TextureLoader();\n    let imageUrl = getAbsoluteImageUrl(currentScene.image);\n    textureLoader.load(imageUrl, texture => {\n      texture.minFilter = THREE.LinearFilter;\n      texture.magFilter = THREE.LinearFilter;\n      // Usar LinearSRGBColorSpace si está disponible, si no, omitir\n      if (texture.colorSpace !== undefined && THREE.LinearSRGBColorSpace) {\n        texture.colorSpace = THREE.LinearSRGBColorSpace;\n      }\n      // Anisotropía para mayor nitidez\n      if (rendererRef.current && rendererRef.current.capabilities.getMaxAnisotropy) {\n        texture.anisotropy = Math.min(16, rendererRef.current.capabilities.getMaxAnisotropy());\n      }\n      const material = new THREE.MeshBasicMaterial({\n        map: texture,\n        side: THREE.DoubleSide\n      });\n      const sphere = new THREE.Mesh(geometry, material);\n      scene.add(sphere);\n    }, undefined, err => {\n      console.error('Error al cargar la textura:', err, imageUrl);\n      const material = new THREE.MeshBasicMaterial({\n        color: 0x444444,\n        side: THREE.DoubleSide\n      });\n      const sphere = new THREE.Mesh(geometry, material);\n      scene.add(sphere);\n    });\n  }, [tour, currentSceneIndex]);\n\n  // Manejar subida de imágenes\n  const handleImageUpload = async e => {\n    let file;\n    if (e.target && e.target.files && e.target.files[0]) {\n      file = e.target.files[0];\n    } else if (e instanceof File) {\n      file = e;\n    } else if (e && e.target && e.target.files) {\n      file = e.target.files[0];\n    }\n    if (!file) return;\n    try {\n      var _uploadRes$data;\n      // Asegura que imageUrl siempre sea un string válido\n      let uploadRes = await api.uploadImage(file);\n      let imageUrl = ((_uploadRes$data = uploadRes.data) === null || _uploadRes$data === void 0 ? void 0 : _uploadRes$data.imageUrl) || uploadRes.imageUrl;\n      if (!imageUrl) {\n        throw new Error('No se recibió la URL de la imagen');\n      }\n      const newScene = {\n        name: `Escena ${tour.scenes.length + 1}`,\n        image: imageUrl,\n        hotspots: []\n      };\n      const updatedTour = {\n        ...tour,\n        scenes: [...tour.scenes, newScene]\n      };\n      const savedTour = await api.updateTour(tourId, updatedTour);\n      setTour(savedTour.data ? savedTour.data : savedTour);\n      setCurrentSceneIndex(updatedTour.scenes.length - 1);\n    } catch (err) {\n      console.error('Error subiendo imagen:', err);\n      alert(`Error al subir imagen: ${err.error || err.message || 'Intente nuevamente'}`);\n    }\n  };\n\n  // Manejar subida de imágenes (DragDrop)\n  const handleDragDropImage = async file => {\n    await handleImageUpload(file);\n  };\n\n  // Guardar hotspot\n  const handleSaveHotspot = async hotspotData => {\n    try {\n      const updatedScenes = [...tour.scenes];\n      const currentScene = updatedScenes[currentSceneIndex];\n      if (hotspotData._id) {\n        const index = currentScene.hotspots.findIndex(h => h._id === hotspotData._id);\n        if (index !== -1) {\n          currentScene.hotspots[index] = hotspotData;\n        }\n      } else {\n        currentScene.hotspots.push({\n          ...hotspotData,\n          _id: Date.now().toString()\n        });\n      }\n      const updatedTour = {\n        ...tour,\n        scenes: updatedScenes\n      };\n      setTour(updatedTour);\n      await api.updateTour(tourId, updatedTour);\n      setSelectedHotspot(null);\n      setIsAddingHotspot(false);\n    } catch (err) {\n      console.error('Error guardando hotspot:', err);\n      alert(`Error al guardar: ${err.error || 'Intente nuevamente'}`);\n    }\n  };\n\n  // Nuevo: Guardar hotspot con pitch/yaw del click\n  const handleSaveHotspotWithCoords = hotspotData => {\n    var _pendingHotspot$pitch, _pendingHotspot$yaw;\n    handleSaveHotspot({\n      ...hotspotData,\n      pitch: (_pendingHotspot$pitch = pendingHotspot === null || pendingHotspot === void 0 ? void 0 : pendingHotspot.pitch) !== null && _pendingHotspot$pitch !== void 0 ? _pendingHotspot$pitch : hotspotData.pitch,\n      yaw: (_pendingHotspot$yaw = pendingHotspot === null || pendingHotspot === void 0 ? void 0 : pendingHotspot.yaw) !== null && _pendingHotspot$yaw !== void 0 ? _pendingHotspot$yaw : hotspotData.yaw\n    });\n    setPendingHotspot(null);\n  };\n\n  // Manejar click en la esfera para añadir hotspot\n  useEffect(() => {\n    if (!isAddingHotspot || !rendererRef.current || !sceneRef.current || !cameraRef.current) return;\n    const handleClick = event => {\n      // Obtener posición del click relativo al canvas\n      const rect = rendererRef.current.domElement.getBoundingClientRect();\n      const x = (event.clientX - rect.left) / rect.width * 2 - 1;\n      const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n\n      // Vector 3D en la dirección de la cámara\n      const vector = new THREE.Vector3(x, y, 0.5).unproject(cameraRef.current);\n\n      // Convertir a coordenadas esféricas (pitch/yaw)\n      const camPos = cameraRef.current.position;\n      const dir = vector.sub(camPos).normalize();\n      const phi = Math.acos(dir.y); // [0, PI]\n      const theta = Math.atan2(dir.x, dir.z); // [-PI, PI]\n\n      // Convertir a grados\n      const pitch = 90 - phi * 180 / Math.PI;\n      const yaw = theta * 180 / Math.PI;\n      setPendingHotspot({\n        pitch: Number(pitch.toFixed(2)),\n        yaw: Number(yaw.toFixed(2))\n      });\n      setIsAddingHotspot(false);\n    };\n    const dom = rendererRef.current.domElement;\n    dom.style.cursor = 'crosshair';\n    dom.addEventListener('click', handleClick);\n    return () => {\n      dom.style.cursor = '';\n      dom.removeEventListener('click', handleClick);\n    };\n  }, [isAddingHotspot]);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"Cargando tour...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 12\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Si no hay escenas, muestra mensaje amigable y área de drag & drop\n  if (!tour.scenes || tour.scenes.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"tour-editor\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: containerRef,\n        className: \"three-container\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ControlPanel, {\n        open: panelOpen,\n        setOpen: setPanelOpen,\n        tour: tour,\n        handleDragDropImage: handleDragDropImage,\n        handleImageUpload: handleImageUpload,\n        scenes: []\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"tour-editor\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"three-container\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ControlPanel, {\n      open: panelOpen,\n      setOpen: setPanelOpen,\n      tour: tour,\n      handleDragDropImage: handleDragDropImage,\n      handleImageUpload: handleImageUpload,\n      scenes: tour.scenes,\n      currentSceneIndex: currentSceneIndex,\n      setCurrentSceneIndex: setCurrentSceneIndex,\n      setIsAddingHotspot: setIsAddingHotspot\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 7\n    }, this), (selectedHotspot || pendingHotspot) && /*#__PURE__*/_jsxDEV(HotspotEditor, {\n      hotspot: selectedHotspot || {\n        pitch: pendingHotspot === null || pendingHotspot === void 0 ? void 0 : pendingHotspot.pitch,\n        yaw: pendingHotspot === null || pendingHotspot === void 0 ? void 0 : pendingHotspot.yaw\n      },\n      scenes: tour.scenes,\n      onSave: pendingHotspot ? handleSaveHotspotWithCoords : handleSaveHotspot,\n      onCancel: () => {\n        setSelectedHotspot(null);\n        setIsAddingHotspot(false);\n        setPendingHotspot(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 340,\n    columnNumber: 5\n  }, this);\n}\n\n// Panel lateral plegable\n_s(TourEditor, \"APo6kJ5zsX0wwmkUwQm8RRmRfQg=\");\n_c = TourEditor;\nfunction ControlPanel({\n  open,\n  setOpen,\n  tour,\n  handleDragDropImage,\n  handleImageUpload,\n  scenes,\n  currentSceneIndex,\n  setCurrentSceneIndex,\n  setIsAddingHotspot\n}) {\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `editor-panel${open ? ' open' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"panel-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"panel-title\",\n          children: \"Tour Virtual 360\\xB0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"panel-toggle\",\n          onClick: () => setOpen(!open),\n          children: open ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: \"\\u276E\"\n          }, void 0, false) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: \"\\u276F\"\n          }, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 9\n      }, this), open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"panel-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"api-key-btn\",\n          children: \"\\uD83D\\uDD11 Mostrar API Key\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"panel-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Im\\xE1genes 360\\xB0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(DragDrop, {\n            onFileUpload: handleDragDropImage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"panel-dragdrop-hint\",\n            children: \"o haz clic para seleccionar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            id: \"image-upload\",\n            accept: \"image/*\",\n            onChange: handleImageUpload,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"panel-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Im\\xE1genes Cargadas (\", scenes.length, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 15\n          }, this), scenes.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"panel-empty\",\n            children: \"No hay im\\xE1genes cargadas\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"panel-image-list\",\n            children: scenes.map((scene, idx) => /*#__PURE__*/_jsxDEV(\"li\", {\n              className: `panel-image-item${currentSceneIndex === idx ? ' active' : ''}`,\n              onClick: () => setCurrentSceneIndex && setCurrentSceneIndex(idx),\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: scene.image ? getAbsoluteImageUrl(scene.image) : '',\n                alt: scene.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 417,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: scene.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 23\n              }, this)]\n            }, scene._id || idx, true, {\n              fileName: _jsxFileName,\n              lineNumber: 412,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"panel-section panel-hint\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Haz clic en \\\"Agregar Punto de Acceso\\\" en la vista principal para conectar im\\xE1genes entre s\\xED.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-add-hotspot\",\n          onClick: () => setIsAddingHotspot && setIsAddingHotspot(true),\n          children: \"\\u2795 Agregar Punto de Acceso\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 7\n    }, this), !open && /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"panel-toggle-collapsed\",\n      onClick: () => setOpen(true),\n      \"aria-label\": \"Abrir panel de control\",\n      children: \"\\u276F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n_c2 = ControlPanel;\nexport default TourEditor;\nvar _c, _c2;\n$RefreshReg$(_c, \"TourEditor\");\n$RefreshReg$(_c2, \"ControlPanel\");","map":{"version":3,"names":["React","useRef","useEffect","useState","THREE","OrbitControls","SceneManager","HotspotEditor","api","DragDrop","jsxDEV","_jsxDEV","Fragment","_Fragment","getAbsoluteImageUrl","image","startsWith","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","TourEditor","tourId","_s","containerRef","tour","setTour","currentSceneIndex","setCurrentSceneIndex","selectedHotspot","setSelectedHotspot","isAddingHotspot","setIsAddingHotspot","loading","setLoading","error","setError","panelOpen","setPanelOpen","sceneRef","cameraRef","rendererRef","controlsRef","pendingHotspot","setPendingHotspot","fetchTour","response","getTour","data","err","console","current","domElement","contains","removeChild","dispose","firstChild","width","clientWidth","window","innerWidth","height","clientHeight","innerHeight","scene","Scene","camera","PerspectiveCamera","position","set","renderer","WebGLRenderer","antialias","setSize","setClearColor","appendChild","controls","enableDamping","dampingFactor","rotateSpeed","animationId","animate","requestAnimationFrame","update","render","handleResize","w","h","aspect","updateProjectionMatrix","addEventListener","removeEventListener","cancelAnimationFrame","scenes","Array","isArray","length","currentScene","children","remove","geometry","SphereGeometry","scale","textureLoader","TextureLoader","imageUrl","load","texture","minFilter","LinearFilter","magFilter","colorSpace","undefined","LinearSRGBColorSpace","capabilities","getMaxAnisotropy","anisotropy","Math","min","material","MeshBasicMaterial","map","side","DoubleSide","sphere","Mesh","add","color","handleImageUpload","e","file","target","files","File","_uploadRes$data","uploadRes","uploadImage","Error","newScene","name","hotspots","updatedTour","savedTour","updateTour","alert","message","handleDragDropImage","handleSaveHotspot","hotspotData","updatedScenes","_id","index","findIndex","push","Date","now","toString","handleSaveHotspotWithCoords","_pendingHotspot$pitch","_pendingHotspot$yaw","pitch","yaw","handleClick","event","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","vector","Vector3","unproject","camPos","dir","sub","normalize","phi","acos","theta","atan2","z","PI","Number","toFixed","dom","style","cursor","className","fileName","_jsxFileName","lineNumber","columnNumber","ref","ControlPanel","open","setOpen","hotspot","onSave","onCancel","_c","onClick","onFileUpload","type","id","accept","onChange","display","idx","src","alt","_c2","$RefreshReg$"],"sources":["D:/respaldo jose/PROJECTS_V0/hub360/frontend/src/components/Editor/TourEditor.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport SceneManager from './SceneManager';\r\nimport HotspotEditor from './HotspotEditor';\r\nimport api from '../../services/api';\r\nimport DragDrop from './DragDrop';\r\nimport './TourEditor.css';\r\n\r\n// Utilidad para obtener la URL absoluta de la imagen\r\nfunction getAbsoluteImageUrl(image) {\r\n  if (!image) return '';\r\n  if (image.startsWith('/uploads/')) {\r\n    return `${process.env.REACT_APP_API_URL?.replace('/api', '') || 'http://localhost:5000'}${image}`;\r\n  }\r\n  return image;\r\n}\r\n\r\nfunction TourEditor({ tourId }) {\r\n  const containerRef = useRef();\r\n  const [tour, setTour] = useState(null);\r\n  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);\r\n  const [selectedHotspot, setSelectedHotspot] = useState(null);\r\n  const [isAddingHotspot, setIsAddingHotspot] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [panelOpen, setPanelOpen] = useState(true);\r\n\r\n  // Referencias de Three.js\r\n  const sceneRef = useRef();\r\n  const cameraRef = useRef();\r\n  const rendererRef = useRef();\r\n  const controlsRef = useRef();\r\n\r\n  // Nuevo: Estado para guardar la posición del click en la esfera\r\n  const [pendingHotspot, setPendingHotspot] = useState(null);\r\n\r\n  // Cargar tour desde la API\r\n  useEffect(() => {\r\n    const fetchTour = async () => {\r\n      try {\r\n        const response = await api.getTour(tourId);\r\n        setTour(response.data);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        setError('Error al cargar el tour');\r\n        setLoading(false);\r\n        console.error(err);\r\n      }\r\n    };\r\n    fetchTour();\r\n  }, [tourId]);\r\n\r\n  // Inicializar Three.js\r\n  useEffect(() => {\r\n    if (!tour || loading) return;\r\n\r\n    // Limpiar canvas anterior si existe\r\n    if (rendererRef.current && rendererRef.current.domElement && containerRef.current) {\r\n      if (containerRef.current.contains(rendererRef.current.domElement)) {\r\n        containerRef.current.removeChild(rendererRef.current.domElement);\r\n      }\r\n      rendererRef.current.dispose();\r\n    }\r\n\r\n    // Eliminar cualquier canvas sobrante (por si acaso)\r\n    if (containerRef.current) {\r\n      while (containerRef.current.firstChild) {\r\n        containerRef.current.removeChild(containerRef.current.firstChild);\r\n      }\r\n    }\r\n\r\n    // Usar el tamaño del contenedor para el renderer\r\n    const width = containerRef.current.clientWidth || window.innerWidth;\r\n    const height = containerRef.current.clientHeight || window.innerHeight;\r\n\r\n    const scene = new THREE.Scene();\r\n    const camera = new THREE.PerspectiveCamera(\r\n      75,\r\n      width / height,\r\n      0.1,\r\n      1000\r\n    );\r\n    camera.position.set(0, 0, 0.1);\r\n\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    renderer.setSize(width, height);\r\n    renderer.setClearColor(0x22232a, 1); // Fondo oscuro, pero no negro puro\r\n    containerRef.current.appendChild(renderer.domElement);\r\n\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.rotateSpeed = 0.5;\r\n\r\n    sceneRef.current = scene;\r\n    cameraRef.current = camera;\r\n    rendererRef.current = renderer;\r\n    controlsRef.current = controls;\r\n\r\n    let animationId;\r\n    const animate = () => {\r\n      animationId = requestAnimationFrame(animate);\r\n      controls.update();\r\n      renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    // Responsivo al tamaño del contenedor\r\n    const handleResize = () => {\r\n      if (!containerRef.current) return;\r\n      const w = containerRef.current.clientWidth || window.innerWidth;\r\n      const h = containerRef.current.clientHeight || window.innerHeight;\r\n      camera.aspect = w / h;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(w, h);\r\n    };\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // Limpieza\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n      if (animationId) cancelAnimationFrame(animationId);\r\n      if (\r\n        rendererRef.current &&\r\n        rendererRef.current.domElement &&\r\n        containerRef.current &&\r\n        containerRef.current.contains(rendererRef.current.domElement)\r\n      ) {\r\n        rendererRef.current.dispose();\r\n        containerRef.current.removeChild(rendererRef.current.domElement);\r\n      }\r\n    };\r\n  }, [tour, loading]);\r\n\r\n  // Cargar la escena current\r\n  useEffect(() => {\r\n    if (\r\n      !tour ||\r\n      !sceneRef.current ||\r\n      !tour.scenes ||\r\n      !Array.isArray(tour.scenes) ||\r\n      tour.scenes.length === 0 ||\r\n      currentSceneIndex === -1 ||\r\n      !tour.scenes[currentSceneIndex]\r\n    ) return;\r\n\r\n    const scene = sceneRef.current;\r\n    const currentScene = tour.scenes[currentSceneIndex];\r\n\r\n    // Limpiar escena anterior\r\n    while (scene.children.length > 0) {\r\n      scene.remove(scene.children[0]);\r\n    }\r\n\r\n    // Crear esfera para la imagen 360 con mayor calidad visual\r\n    const geometry = new THREE.SphereGeometry(500, 128, 96); // Más segmentos para suavidad\r\n    geometry.scale(-1, 1, 1);\r\n\r\n    const textureLoader = new THREE.TextureLoader();\r\n    let imageUrl = getAbsoluteImageUrl(currentScene.image);\r\n\r\n    textureLoader.load(\r\n      imageUrl,\r\n      texture => {\r\n        texture.minFilter = THREE.LinearFilter;\r\n        texture.magFilter = THREE.LinearFilter;\r\n        // Usar LinearSRGBColorSpace si está disponible, si no, omitir\r\n        if (texture.colorSpace !== undefined && THREE.LinearSRGBColorSpace) {\r\n          texture.colorSpace = THREE.LinearSRGBColorSpace;\r\n        }\r\n        // Anisotropía para mayor nitidez\r\n        if (rendererRef.current && rendererRef.current.capabilities.getMaxAnisotropy) {\r\n          texture.anisotropy = Math.min(16, rendererRef.current.capabilities.getMaxAnisotropy());\r\n        }\r\n        const material = new THREE.MeshBasicMaterial({\r\n          map: texture,\r\n          side: THREE.DoubleSide\r\n        });\r\n        const sphere = new THREE.Mesh(geometry, material);\r\n        scene.add(sphere);\r\n      },\r\n      undefined,\r\n      err => {\r\n        console.error('Error al cargar la textura:', err, imageUrl);\r\n        const material = new THREE.MeshBasicMaterial({ color: 0x444444, side: THREE.DoubleSide });\r\n        const sphere = new THREE.Mesh(geometry, material);\r\n        scene.add(sphere);\r\n      }\r\n    );\r\n  }, [tour, currentSceneIndex]);\r\n\r\n  // Manejar subida de imágenes\r\n  const handleImageUpload = async (e) => {\r\n    let file;\r\n    if (e.target && e.target.files && e.target.files[0]) {\r\n      file = e.target.files[0];\r\n    } else if (e instanceof File) {\r\n      file = e;\r\n    } else if (e && e.target && e.target.files) {\r\n      file = e.target.files[0];\r\n    }\r\n    if (!file) return;\r\n\r\n    try {\r\n      // Asegura que imageUrl siempre sea un string válido\r\n      let uploadRes = await api.uploadImage(file);\r\n      let imageUrl = uploadRes.data?.imageUrl || uploadRes.imageUrl;\r\n      if (!imageUrl) {\r\n        throw new Error('No se recibió la URL de la imagen');\r\n      }\r\n      const newScene = {\r\n        name: `Escena ${tour.scenes.length + 1}`,\r\n        image: imageUrl,\r\n        hotspots: []\r\n      };\r\n      const updatedTour = {\r\n        ...tour,\r\n        scenes: [...tour.scenes, newScene]\r\n      };\r\n      const savedTour = await api.updateTour(tourId, updatedTour);\r\n      setTour(savedTour.data ? savedTour.data : savedTour);\r\n      setCurrentSceneIndex(updatedTour.scenes.length - 1);\r\n    } catch (err) {\r\n      console.error('Error subiendo imagen:', err);\r\n      alert(`Error al subir imagen: ${err.error || err.message || 'Intente nuevamente'}`);\r\n    }\r\n  };\r\n\r\n  // Manejar subida de imágenes (DragDrop)\r\n  const handleDragDropImage = async (file) => {\r\n    await handleImageUpload(file);\r\n  };\r\n\r\n  // Guardar hotspot\r\n  const handleSaveHotspot = async (hotspotData) => {\r\n    try {\r\n      const updatedScenes = [...tour.scenes];\r\n      const currentScene = updatedScenes[currentSceneIndex];\r\n\r\n      if (hotspotData._id) {\r\n        const index = currentScene.hotspots.findIndex(h => h._id === hotspotData._id);\r\n        if (index !== -1) {\r\n          currentScene.hotspots[index] = hotspotData;\r\n        }\r\n      } else {\r\n        currentScene.hotspots.push({\r\n          ...hotspotData,\r\n          _id: Date.now().toString()\r\n        });\r\n      }\r\n\r\n      const updatedTour = { ...tour, scenes: updatedScenes };\r\n      setTour(updatedTour);\r\n      await api.updateTour(tourId, updatedTour);\r\n      setSelectedHotspot(null);\r\n      setIsAddingHotspot(false);\r\n    } catch (err) {\r\n      console.error('Error guardando hotspot:', err);\r\n      alert(`Error al guardar: ${err.error || 'Intente nuevamente'}`);\r\n    }\r\n  };\r\n\r\n  // Nuevo: Guardar hotspot con pitch/yaw del click\r\n  const handleSaveHotspotWithCoords = (hotspotData) => {\r\n    handleSaveHotspot({\r\n      ...hotspotData,\r\n      pitch: pendingHotspot?.pitch ?? hotspotData.pitch,\r\n      yaw: pendingHotspot?.yaw ?? hotspotData.yaw\r\n    });\r\n    setPendingHotspot(null);\r\n  };\r\n\r\n  // Manejar click en la esfera para añadir hotspot\r\n  useEffect(() => {\r\n    if (!isAddingHotspot || !rendererRef.current || !sceneRef.current || !cameraRef.current) return;\r\n\r\n    const handleClick = (event) => {\r\n      // Obtener posición del click relativo al canvas\r\n      const rect = rendererRef.current.domElement.getBoundingClientRect();\r\n      const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\r\n      const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\r\n\r\n      // Vector 3D en la dirección de la cámara\r\n      const vector = new THREE.Vector3(x, y, 0.5).unproject(cameraRef.current);\r\n\r\n      // Convertir a coordenadas esféricas (pitch/yaw)\r\n      const camPos = cameraRef.current.position;\r\n      const dir = vector.sub(camPos).normalize();\r\n      const phi = Math.acos(dir.y); // [0, PI]\r\n      const theta = Math.atan2(dir.x, dir.z); // [-PI, PI]\r\n\r\n      // Convertir a grados\r\n      const pitch = 90 - (phi * 180 / Math.PI);\r\n      const yaw = theta * 180 / Math.PI;\r\n\r\n      setPendingHotspot({\r\n        pitch: Number(pitch.toFixed(2)),\r\n        yaw: Number(yaw.toFixed(2))\r\n      });\r\n      setIsAddingHotspot(false);\r\n    };\r\n\r\n    const dom = rendererRef.current.domElement;\r\n    dom.style.cursor = 'crosshair';\r\n    dom.addEventListener('click', handleClick);\r\n\r\n    return () => {\r\n      dom.style.cursor = '';\r\n      dom.removeEventListener('click', handleClick);\r\n    };\r\n  }, [isAddingHotspot]);\r\n\r\n  if (loading) {\r\n    return <div className=\"loading\">Cargando tour...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div className=\"error\">{error}</div>;\r\n  }\r\n\r\n  // Si no hay escenas, muestra mensaje amigable y área de drag & drop\r\n  if (!tour.scenes || tour.scenes.length === 0) {\r\n    return (\r\n      <div className=\"tour-editor\">\r\n        <div ref={containerRef} className=\"three-container\" />\r\n        <ControlPanel\r\n          open={panelOpen}\r\n          setOpen={setPanelOpen}\r\n          tour={tour}\r\n          handleDragDropImage={handleDragDropImage}\r\n          handleImageUpload={handleImageUpload}\r\n          scenes={[]}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"tour-editor\">\r\n      <div ref={containerRef} className=\"three-container\" />\r\n      <ControlPanel\r\n        open={panelOpen}\r\n        setOpen={setPanelOpen}\r\n        tour={tour}\r\n        handleDragDropImage={handleDragDropImage}\r\n        handleImageUpload={handleImageUpload}\r\n        scenes={tour.scenes}\r\n        currentSceneIndex={currentSceneIndex}\r\n        setCurrentSceneIndex={setCurrentSceneIndex}\r\n        setIsAddingHotspot={setIsAddingHotspot}\r\n      />\r\n      {(selectedHotspot || pendingHotspot) && (\r\n        <HotspotEditor\r\n          hotspot={selectedHotspot || { pitch: pendingHotspot?.pitch, yaw: pendingHotspot?.yaw }}\r\n          scenes={tour.scenes}\r\n          onSave={pendingHotspot ? handleSaveHotspotWithCoords : handleSaveHotspot}\r\n          onCancel={() => {\r\n            setSelectedHotspot(null);\r\n            setIsAddingHotspot(false);\r\n            setPendingHotspot(null);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Panel lateral plegable\r\nfunction ControlPanel({\r\n  open,\r\n  setOpen,\r\n  tour,\r\n  handleDragDropImage,\r\n  handleImageUpload,\r\n  scenes,\r\n  currentSceneIndex,\r\n  setCurrentSceneIndex,\r\n  setIsAddingHotspot\r\n}) {\r\n  return (\r\n    <>\r\n      <aside className={`editor-panel${open ? ' open' : ''}`}>\r\n        <div className=\"panel-header\">\r\n          <span className=\"panel-title\">Tour Virtual 360°</span>\r\n          <button className=\"panel-toggle\" onClick={() => setOpen(!open)}>\r\n            {open ? <>&#10094;</> : <>&#10095;</>}\r\n          </button>\r\n        </div>\r\n        {open && (\r\n          <div className=\"panel-content\">\r\n            <button className=\"api-key-btn\">🔑 Mostrar API Key</button>\r\n            <div className=\"panel-section\">\r\n              <h3>Imágenes 360°</h3>\r\n              <DragDrop onFileUpload={handleDragDropImage} />\r\n              <div className=\"panel-dragdrop-hint\">o haz clic para seleccionar</div>\r\n              <input\r\n                type=\"file\"\r\n                id=\"image-upload\"\r\n                accept=\"image/*\"\r\n                onChange={handleImageUpload}\r\n                style={{ display: 'none' }}\r\n              />\r\n            </div>\r\n            <div className=\"panel-section\">\r\n              <h3>Imágenes Cargadas ({scenes.length})</h3>\r\n              {scenes.length === 0 ? (\r\n                <div className=\"panel-empty\">No hay imágenes cargadas</div>\r\n              ) : (\r\n                <ul className=\"panel-image-list\">\r\n                  {scenes.map((scene, idx) => (\r\n                    <li\r\n                      key={scene._id || idx}\r\n                      className={`panel-image-item${currentSceneIndex === idx ? ' active' : ''}`}\r\n                      onClick={() => setCurrentSceneIndex && setCurrentSceneIndex(idx)}\r\n                    >\r\n                      <img src={scene.image ? getAbsoluteImageUrl(scene.image) : ''} alt={scene.name} />\r\n                      <span>{scene.name}</span>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              )}\r\n            </div>\r\n            <div className=\"panel-section panel-hint\">\r\n              <span>\r\n                Haz clic en \"Agregar Punto de Acceso\" en la vista principal para conectar imágenes entre sí.\r\n              </span>\r\n            </div>\r\n            <button\r\n              className=\"btn-add-hotspot\"\r\n              onClick={() => setIsAddingHotspot && setIsAddingHotspot(true)}\r\n            >\r\n              ➕ Agregar Punto de Acceso\r\n            </button>\r\n          </div>\r\n        )}\r\n      </aside>\r\n      {!open && (\r\n        <button\r\n          className=\"panel-toggle-collapsed\"\r\n          onClick={() => setOpen(true)}\r\n          aria-label=\"Abrir panel de control\"\r\n        >\r\n          &#10095;\r\n        </button>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default TourEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}