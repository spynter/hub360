{"ast":null,"code":"var _jsxFileName = \"D:\\\\respaldo jose\\\\PROJECTS_V0\\\\hub360\\\\frontend\\\\src\\\\components\\\\Editor\\\\TourEditor.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport SceneManager from './SceneManager';\nimport HotspotEditor from './HotspotEditor';\nimport api from '../../services/api';\nimport DragDrop from './DragDrop';\nimport './TourEditor.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction TourEditor({\n  tourId\n}) {\n  _s();\n  const containerRef = useRef();\n  const [tour, setTour] = useState(null);\n  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);\n  const [selectedHotspot, setSelectedHotspot] = useState(null);\n  const [isAddingHotspot, setIsAddingHotspot] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Referencias de Three.js\n  const sceneRef = useRef();\n  const cameraRef = useRef();\n  const rendererRef = useRef();\n  const controlsRef = useRef();\n\n  // Cargar tour desde la API\n  useEffect(() => {\n    const fetchTour = async () => {\n      try {\n        const response = await api.getTour(tourId);\n        setTour(response.data);\n        setLoading(false);\n      } catch (err) {\n        setError('Error al cargar el tour');\n        setLoading(false);\n        console.error(err);\n      }\n    };\n    fetchTour();\n  }, [tourId]);\n\n  // Inicializar Three.js\n  useEffect(() => {\n    if (!tour || loading) return;\n\n    // Limpiar canvas anterior si existe\n    if (rendererRef.current && rendererRef.current.domElement && containerRef.current) {\n      if (containerRef.current.contains(rendererRef.current.domElement)) {\n        containerRef.current.removeChild(rendererRef.current.domElement);\n      }\n      rendererRef.current.dispose();\n    }\n\n    // Usar el tamaño del contenedor para el renderer\n    const width = containerRef.current.clientWidth || window.innerWidth;\n    const height = containerRef.current.clientHeight || window.innerHeight;\n    const scene = new THREE.Scene();\n    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\n    camera.position.set(0, 0, 0.1);\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(width, height);\n    renderer.setClearColor(0x22232a, 1); // Fondo oscuro, pero no negro puro\n    containerRef.current.appendChild(renderer.domElement);\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n    controls.rotateSpeed = 0.5;\n    sceneRef.current = scene;\n    cameraRef.current = camera;\n    rendererRef.current = renderer;\n    controlsRef.current = controls;\n    let animationId;\n    const animate = () => {\n      animationId = requestAnimationFrame(animate);\n      controls.update();\n      renderer.render(scene, camera);\n    };\n    animate();\n\n    // Responsivo al tamaño del contenedor\n    const handleResize = () => {\n      if (!containerRef.current) return;\n      const w = containerRef.current.clientWidth || window.innerWidth;\n      const h = containerRef.current.clientHeight || window.innerHeight;\n      camera.aspect = w / h;\n      camera.updateProjectionMatrix();\n      renderer.setSize(w, h);\n    };\n    window.addEventListener('resize', handleResize);\n\n    // Limpieza\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (animationId) cancelAnimationFrame(animationId);\n      if (rendererRef.current && rendererRef.current.domElement && containerRef.current && containerRef.current.contains(rendererRef.current.domElement)) {\n        rendererRef.current.dispose();\n        containerRef.current.removeChild(rendererRef.current.domElement);\n      }\n    };\n  }, [tour, loading]);\n\n  // Cargar la escena current\n  useEffect(() => {\n    if (!tour || !sceneRef.current || !tour.scenes || !Array.isArray(tour.scenes) || tour.scenes.length === 0 || currentSceneIndex === -1 || !tour.scenes[currentSceneIndex]) return;\n    const scene = sceneRef.current;\n    const currentScene = tour.scenes[currentSceneIndex];\n\n    // Limpiar escena anterior\n    while (scene.children.length > 0) {\n      scene.remove(scene.children[0]);\n    }\n\n    // Crear esfera para la imagen 360\n    const geometry = new THREE.SphereGeometry(500, 60, 40);\n    geometry.scale(-1, 1, 1);\n    const textureLoader = new THREE.TextureLoader();\n    let imageUrl = getAbsoluteImageUrl(currentScene.image);\n    textureLoader.load(imageUrl, texture => {\n      const material = new THREE.MeshBasicMaterial({\n        map: texture,\n        side: THREE.DoubleSide\n      });\n      const sphere = new THREE.Mesh(geometry, material);\n      scene.add(sphere);\n    }, undefined, err => {\n      console.error('Error al cargar la textura:', err, imageUrl);\n      const material = new THREE.MeshBasicMaterial({\n        color: 0x444444,\n        side: THREE.DoubleSide\n      });\n      const sphere = new THREE.Mesh(geometry, material);\n      scene.add(sphere);\n    });\n  }, [tour, currentSceneIndex]);\n\n  // Utilidad para obtener la URL absoluta de la imagen\n  function getAbsoluteImageUrl(image) {\n    if (!image) return '';\n    if (image.startsWith('/uploads/')) {\n      var _process$env$REACT_AP;\n      return `${((_process$env$REACT_AP = process.env.REACT_APP_API_URL) === null || _process$env$REACT_AP === void 0 ? void 0 : _process$env$REACT_AP.replace('/api', '')) || 'http://localhost:5000'}${image}`;\n    }\n    return image;\n  }\n\n  // Manejar subida de imágenes\n  const handleImageUpload = async e => {\n    let file;\n    if (e.target && e.target.files && e.target.files[0]) {\n      file = e.target.files[0];\n    } else if (e instanceof File) {\n      file = e;\n    } else if (e && e.target && e.target.files) {\n      file = e.target.files[0];\n    }\n    if (!file) return;\n    try {\n      var _uploadRes$data;\n      // Asegura que imageUrl siempre sea un string válido\n      let uploadRes = await api.uploadImage(file);\n      let imageUrl = ((_uploadRes$data = uploadRes.data) === null || _uploadRes$data === void 0 ? void 0 : _uploadRes$data.imageUrl) || uploadRes.imageUrl;\n      if (!imageUrl) {\n        throw new Error('No se recibió la URL de la imagen');\n      }\n      const newScene = {\n        name: `Escena ${tour.scenes.length + 1}`,\n        image: imageUrl,\n        hotspots: []\n      };\n      const updatedTour = {\n        ...tour,\n        scenes: [...tour.scenes, newScene]\n      };\n      const savedTour = await api.updateTour(tourId, updatedTour);\n      setTour(savedTour.data ? savedTour.data : savedTour);\n      setCurrentSceneIndex(updatedTour.scenes.length - 1);\n    } catch (err) {\n      console.error('Error subiendo imagen:', err);\n      alert(`Error al subir imagen: ${err.error || err.message || 'Intente nuevamente'}`);\n    }\n  };\n\n  // Manejar subida de imágenes (DragDrop)\n  const handleDragDropImage = async file => {\n    await handleImageUpload(file);\n  };\n\n  // Guardar hotspot\n  const handleSaveHotspot = async hotspotData => {\n    try {\n      const updatedScenes = [...tour.scenes];\n      const currentScene = updatedScenes[currentSceneIndex];\n      if (hotspotData._id) {\n        const index = currentScene.hotspots.findIndex(h => h._id === hotspotData._id);\n        if (index !== -1) {\n          currentScene.hotspots[index] = hotspotData;\n        }\n      } else {\n        currentScene.hotspots.push({\n          ...hotspotData,\n          _id: Date.now().toString()\n        });\n      }\n      const updatedTour = {\n        ...tour,\n        scenes: updatedScenes\n      };\n      setTour(updatedTour);\n      await api.updateTour(tourId, updatedTour);\n      setSelectedHotspot(null);\n      setIsAddingHotspot(false);\n    } catch (err) {\n      console.error('Error guardando hotspot:', err);\n      alert(`Error al guardar: ${err.error || 'Intente nuevamente'}`);\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"Cargando tour...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 12\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Si no hay escenas, muestra mensaje amigable y área de drag & drop\n  if (!tour.scenes || tour.scenes.length === 0) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"tour-editor\",\n      style: {\n        width: '100vw',\n        height: '100vh',\n        background: '#1e293b',\n        position: 'relative',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: containerRef,\n        className: \"three-container\",\n        style: {\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          background: '#1e293b',\n          zIndex: 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'relative',\n          zIndex: 2,\n          background: 'rgba(15,23,42,0.97)',\n          borderRadius: 16,\n          boxShadow: '0 8px 32px rgba(0,0,0,0.25)',\n          padding: '48px 32px',\n          minWidth: 340,\n          maxWidth: 400,\n          textAlign: 'center',\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 48,\n            color: '#38bdf8',\n            marginBottom: 16\n          },\n          children: \"\\uD83D\\uDDBC\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            color: '#e2e8f0',\n            marginBottom: 12,\n            fontWeight: 600\n          },\n          children: \"No hay im\\xE1genes 360\\xB0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#94a3b8',\n            marginBottom: 24\n          },\n          children: \"Arrastra y suelta una imagen 360\\xB0 aqu\\xED para comenzar tu tour.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(DragDrop, {\n          onFileUpload: handleDragDropImage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: '18px 0',\n            color: '#64748b',\n            fontSize: 14\n          },\n          children: \"o haz clic para seleccionar una imagen desde tu dispositivo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          id: \"image-upload\",\n          accept: \"image/*\",\n          onChange: handleImageUpload,\n          style: {\n            display: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-upload\",\n          style: {\n            background: '#38bdf8',\n            color: '#fff',\n            border: 'none',\n            borderRadius: 6,\n            padding: '12px 28px',\n            fontWeight: 500,\n            fontSize: 16,\n            marginTop: 8,\n            cursor: 'pointer'\n          },\n          onClick: () => document.getElementById('image-upload').click(),\n          children: \"Subir Imagen 360\\xB0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"tour-editor\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"three-container\",\n      style: {\n        width: '100%',\n        height: '100vh',\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        zIndex: 1\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative',\n        zIndex: 2\n      },\n      children: [/*#__PURE__*/_jsxDEV(SceneManager, {\n        scenes: tour.scenes,\n        currentIndex: currentSceneIndex,\n        onSelectScene: setCurrentSceneIndex\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          id: \"image-upload\",\n          accept: \"image/*\",\n          onChange: handleImageUpload,\n          style: {\n            display: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-upload\",\n          onClick: () => document.getElementById('image-upload').click(),\n          children: \"Subir Nueva Escena\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(DragDrop, {\n          onFileUpload: handleDragDropImage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-add-hotspot\",\n          onClick: () => setIsAddingHotspot(true),\n          children: \"A\\xF1adir Hotspot\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 7\n    }, this), (selectedHotspot || isAddingHotspot) && /*#__PURE__*/_jsxDEV(HotspotEditor, {\n      hotspot: selectedHotspot || {},\n      scenes: tour.scenes,\n      onSave: handleSaveHotspot,\n      onCancel: () => {\n        setSelectedHotspot(null);\n        setIsAddingHotspot(false);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 319,\n    columnNumber: 5\n  }, this);\n}\n_s(TourEditor, \"8ZT1lh1uzmJYCruSVS1gCLXEsPM=\");\n_c = TourEditor;\nexport default TourEditor;\nvar _c;\n$RefreshReg$(_c, \"TourEditor\");","map":{"version":3,"names":["React","useRef","useEffect","useState","THREE","OrbitControls","SceneManager","HotspotEditor","api","DragDrop","jsxDEV","_jsxDEV","TourEditor","tourId","_s","containerRef","tour","setTour","currentSceneIndex","setCurrentSceneIndex","selectedHotspot","setSelectedHotspot","isAddingHotspot","setIsAddingHotspot","loading","setLoading","error","setError","sceneRef","cameraRef","rendererRef","controlsRef","fetchTour","response","getTour","data","err","console","current","domElement","contains","removeChild","dispose","width","clientWidth","window","innerWidth","height","clientHeight","innerHeight","scene","Scene","camera","PerspectiveCamera","position","set","renderer","WebGLRenderer","antialias","setSize","setClearColor","appendChild","controls","enableDamping","dampingFactor","rotateSpeed","animationId","animate","requestAnimationFrame","update","render","handleResize","w","h","aspect","updateProjectionMatrix","addEventListener","removeEventListener","cancelAnimationFrame","scenes","Array","isArray","length","currentScene","children","remove","geometry","SphereGeometry","scale","textureLoader","TextureLoader","imageUrl","getAbsoluteImageUrl","image","load","texture","material","MeshBasicMaterial","map","side","DoubleSide","sphere","Mesh","add","undefined","color","startsWith","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","handleImageUpload","e","file","target","files","File","_uploadRes$data","uploadRes","uploadImage","Error","newScene","name","hotspots","updatedTour","savedTour","updateTour","alert","message","handleDragDropImage","handleSaveHotspot","hotspotData","updatedScenes","_id","index","findIndex","push","Date","now","toString","className","fileName","_jsxFileName","lineNumber","columnNumber","style","background","display","alignItems","justifyContent","ref","top","left","zIndex","borderRadius","boxShadow","padding","minWidth","maxWidth","textAlign","flexDirection","fontSize","marginBottom","fontWeight","onFileUpload","margin","type","id","accept","onChange","border","marginTop","cursor","onClick","document","getElementById","click","currentIndex","onSelectScene","hotspot","onSave","onCancel","_c","$RefreshReg$"],"sources":["D:/respaldo jose/PROJECTS_V0/hub360/frontend/src/components/Editor/TourEditor.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport SceneManager from './SceneManager';\r\nimport HotspotEditor from './HotspotEditor';\r\nimport api from '../../services/api';\r\nimport DragDrop from './DragDrop';\r\nimport './TourEditor.css';\r\n\r\nfunction TourEditor({ tourId }) {\r\n  const containerRef = useRef();\r\n  const [tour, setTour] = useState(null);\r\n  const [currentSceneIndex, setCurrentSceneIndex] = useState(0);\r\n  const [selectedHotspot, setSelectedHotspot] = useState(null);\r\n  const [isAddingHotspot, setIsAddingHotspot] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Referencias de Three.js\r\n  const sceneRef = useRef();\r\n  const cameraRef = useRef();\r\n  const rendererRef = useRef();\r\n  const controlsRef = useRef();\r\n\r\n  // Cargar tour desde la API\r\n  useEffect(() => {\r\n    const fetchTour = async () => {\r\n      try {\r\n        const response = await api.getTour(tourId);\r\n        setTour(response.data);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        setError('Error al cargar el tour');\r\n        setLoading(false);\r\n        console.error(err);\r\n      }\r\n    };\r\n    fetchTour();\r\n  }, [tourId]);\r\n\r\n  // Inicializar Three.js\r\n  useEffect(() => {\r\n    if (!tour || loading) return;\r\n\r\n    // Limpiar canvas anterior si existe\r\n    if (rendererRef.current && rendererRef.current.domElement && containerRef.current) {\r\n      if (containerRef.current.contains(rendererRef.current.domElement)) {\r\n        containerRef.current.removeChild(rendererRef.current.domElement);\r\n      }\r\n      rendererRef.current.dispose();\r\n    }\r\n\r\n    // Usar el tamaño del contenedor para el renderer\r\n    const width = containerRef.current.clientWidth || window.innerWidth;\r\n    const height = containerRef.current.clientHeight || window.innerHeight;\r\n\r\n    const scene = new THREE.Scene();\r\n    const camera = new THREE.PerspectiveCamera(\r\n      75,\r\n      width / height,\r\n      0.1,\r\n      1000\r\n    );\r\n    camera.position.set(0, 0, 0.1);\r\n\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    renderer.setSize(width, height);\r\n    renderer.setClearColor(0x22232a, 1); // Fondo oscuro, pero no negro puro\r\n    containerRef.current.appendChild(renderer.domElement);\r\n\r\n    const controls = new OrbitControls(camera, renderer.domElement);\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.rotateSpeed = 0.5;\r\n\r\n    sceneRef.current = scene;\r\n    cameraRef.current = camera;\r\n    rendererRef.current = renderer;\r\n    controlsRef.current = controls;\r\n\r\n    let animationId;\r\n    const animate = () => {\r\n      animationId = requestAnimationFrame(animate);\r\n      controls.update();\r\n      renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    // Responsivo al tamaño del contenedor\r\n    const handleResize = () => {\r\n      if (!containerRef.current) return;\r\n      const w = containerRef.current.clientWidth || window.innerWidth;\r\n      const h = containerRef.current.clientHeight || window.innerHeight;\r\n      camera.aspect = w / h;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(w, h);\r\n    };\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // Limpieza\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n      if (animationId) cancelAnimationFrame(animationId);\r\n      if (\r\n        rendererRef.current &&\r\n        rendererRef.current.domElement &&\r\n        containerRef.current &&\r\n        containerRef.current.contains(rendererRef.current.domElement)\r\n      ) {\r\n        rendererRef.current.dispose();\r\n        containerRef.current.removeChild(rendererRef.current.domElement);\r\n      }\r\n    };\r\n  }, [tour, loading]);\r\n\r\n  // Cargar la escena current\r\n  useEffect(() => {\r\n    if (\r\n      !tour ||\r\n      !sceneRef.current ||\r\n      !tour.scenes ||\r\n      !Array.isArray(tour.scenes) ||\r\n      tour.scenes.length === 0 ||\r\n      currentSceneIndex === -1 ||\r\n      !tour.scenes[currentSceneIndex]\r\n    ) return;\r\n\r\n    const scene = sceneRef.current;\r\n    const currentScene = tour.scenes[currentSceneIndex];\r\n\r\n    // Limpiar escena anterior\r\n    while (scene.children.length > 0) {\r\n      scene.remove(scene.children[0]);\r\n    }\r\n\r\n    // Crear esfera para la imagen 360\r\n    const geometry = new THREE.SphereGeometry(500, 60, 40);\r\n    geometry.scale(-1, 1, 1);\r\n\r\n    const textureLoader = new THREE.TextureLoader();\r\n    let imageUrl = getAbsoluteImageUrl(currentScene.image);\r\n\r\n    textureLoader.load(\r\n      imageUrl,\r\n      texture => {\r\n        const material = new THREE.MeshBasicMaterial({\r\n          map: texture,\r\n          side: THREE.DoubleSide\r\n        });\r\n        const sphere = new THREE.Mesh(geometry, material);\r\n        scene.add(sphere);\r\n      },\r\n      undefined,\r\n      err => {\r\n        console.error('Error al cargar la textura:', err, imageUrl);\r\n        const material = new THREE.MeshBasicMaterial({ color: 0x444444, side: THREE.DoubleSide });\r\n        const sphere = new THREE.Mesh(geometry, material);\r\n        scene.add(sphere);\r\n      }\r\n    );\r\n  }, [tour, currentSceneIndex]);\r\n\r\n  // Utilidad para obtener la URL absoluta de la imagen\r\n  function getAbsoluteImageUrl(image) {\r\n    if (!image) return '';\r\n    if (image.startsWith('/uploads/')) {\r\n      return `${process.env.REACT_APP_API_URL?.replace('/api', '') || 'http://localhost:5000'}${image}`;\r\n    }\r\n    return image;\r\n  }\r\n\r\n  // Manejar subida de imágenes\r\n  const handleImageUpload = async (e) => {\r\n    let file;\r\n    if (e.target && e.target.files && e.target.files[0]) {\r\n      file = e.target.files[0];\r\n    } else if (e instanceof File) {\r\n      file = e;\r\n    } else if (e && e.target && e.target.files) {\r\n      file = e.target.files[0];\r\n    }\r\n    if (!file) return;\r\n\r\n    try {\r\n      // Asegura que imageUrl siempre sea un string válido\r\n      let uploadRes = await api.uploadImage(file);\r\n      let imageUrl = uploadRes.data?.imageUrl || uploadRes.imageUrl;\r\n      if (!imageUrl) {\r\n        throw new Error('No se recibió la URL de la imagen');\r\n      }\r\n      const newScene = {\r\n        name: `Escena ${tour.scenes.length + 1}`,\r\n        image: imageUrl,\r\n        hotspots: []\r\n      };\r\n      const updatedTour = {\r\n        ...tour,\r\n        scenes: [...tour.scenes, newScene]\r\n      };\r\n      const savedTour = await api.updateTour(tourId, updatedTour);\r\n      setTour(savedTour.data ? savedTour.data : savedTour);\r\n      setCurrentSceneIndex(updatedTour.scenes.length - 1);\r\n    } catch (err) {\r\n      console.error('Error subiendo imagen:', err);\r\n      alert(`Error al subir imagen: ${err.error || err.message || 'Intente nuevamente'}`);\r\n    }\r\n  };\r\n\r\n  // Manejar subida de imágenes (DragDrop)\r\n  const handleDragDropImage = async (file) => {\r\n    await handleImageUpload(file);\r\n  };\r\n\r\n  // Guardar hotspot\r\n  const handleSaveHotspot = async (hotspotData) => {\r\n    try {\r\n      const updatedScenes = [...tour.scenes];\r\n      const currentScene = updatedScenes[currentSceneIndex];\r\n\r\n      if (hotspotData._id) {\r\n        const index = currentScene.hotspots.findIndex(h => h._id === hotspotData._id);\r\n        if (index !== -1) {\r\n          currentScene.hotspots[index] = hotspotData;\r\n        }\r\n      } else {\r\n        currentScene.hotspots.push({\r\n          ...hotspotData,\r\n          _id: Date.now().toString()\r\n        });\r\n      }\r\n\r\n      const updatedTour = { ...tour, scenes: updatedScenes };\r\n      setTour(updatedTour);\r\n      await api.updateTour(tourId, updatedTour);\r\n      setSelectedHotspot(null);\r\n      setIsAddingHotspot(false);\r\n    } catch (err) {\r\n      console.error('Error guardando hotspot:', err);\r\n      alert(`Error al guardar: ${err.error || 'Intente nuevamente'}`);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"loading\">Cargando tour...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div className=\"error\">{error}</div>;\r\n  }\r\n\r\n  // Si no hay escenas, muestra mensaje amigable y área de drag & drop\r\n  if (!tour.scenes || tour.scenes.length === 0) {\r\n    return (\r\n      <div className=\"tour-editor\" style={{ width: '100vw', height: '100vh', background: '#1e293b', position: 'relative', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n        <div\r\n          ref={containerRef}\r\n          className=\"three-container\"\r\n          style={{\r\n            position: 'absolute',\r\n            top: 0, left: 0, width: '100%', height: '100%',\r\n            background: '#1e293b', zIndex: 1\r\n          }}\r\n        />\r\n        <div\r\n          style={{\r\n            position: 'relative',\r\n            zIndex: 2,\r\n            background: 'rgba(15,23,42,0.97)',\r\n            borderRadius: 16,\r\n            boxShadow: '0 8px 32px rgba(0,0,0,0.25)',\r\n            padding: '48px 32px',\r\n            minWidth: 340,\r\n            maxWidth: 400,\r\n            textAlign: 'center',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center'\r\n          }}\r\n        >\r\n          <div style={{ fontSize: 48, color: '#38bdf8', marginBottom: 16 }}>🖼️</div>\r\n          <h2 style={{ color: '#e2e8f0', marginBottom: 12, fontWeight: 600 }}>No hay imágenes 360°</h2>\r\n          <p style={{ color: '#94a3b8', marginBottom: 24 }}>\r\n            Arrastra y suelta una imagen 360° aquí para comenzar tu tour.\r\n          </p>\r\n          <DragDrop onFileUpload={handleDragDropImage} />\r\n          <div style={{ margin: '18px 0', color: '#64748b', fontSize: 14 }}>\r\n            o haz clic para seleccionar una imagen desde tu dispositivo\r\n          </div>\r\n          <input\r\n            type=\"file\"\r\n            id=\"image-upload\"\r\n            accept=\"image/*\"\r\n            onChange={handleImageUpload}\r\n            style={{ display: 'none' }}\r\n          />\r\n          <button\r\n            className=\"btn-upload\"\r\n            style={{\r\n              background: '#38bdf8',\r\n              color: '#fff',\r\n              border: 'none',\r\n              borderRadius: 6,\r\n              padding: '12px 28px',\r\n              fontWeight: 500,\r\n              fontSize: 16,\r\n              marginTop: 8,\r\n              cursor: 'pointer'\r\n            }}\r\n            onClick={() => document.getElementById('image-upload').click()}\r\n          >\r\n            Subir Imagen 360°\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"tour-editor\">\r\n      <div\r\n        ref={containerRef}\r\n        className=\"three-container\"\r\n        style={{ width: '100%', height: '100vh', position: 'absolute', top: 0, left: 0, zIndex: 1 }}\r\n      />\r\n      <div style={{ position: 'relative', zIndex: 2 }}>\r\n        <SceneManager\r\n          scenes={tour.scenes}\r\n          currentIndex={currentSceneIndex}\r\n          onSelectScene={setCurrentSceneIndex}\r\n        />\r\n\r\n        <div className=\"editor-controls\">\r\n          <input\r\n            type=\"file\"\r\n            id=\"image-upload\"\r\n            accept=\"image/*\"\r\n            onChange={handleImageUpload}\r\n            style={{ display: 'none' }}\r\n          />\r\n          <button\r\n            className=\"btn-upload\"\r\n            onClick={() => document.getElementById('image-upload').click()}\r\n          >\r\n            Subir Nueva Escena\r\n          </button>\r\n          <DragDrop onFileUpload={handleDragDropImage} />\r\n          <button\r\n            className=\"btn-add-hotspot\"\r\n            onClick={() => setIsAddingHotspot(true)}\r\n          >\r\n            Añadir Hotspot\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {(selectedHotspot || isAddingHotspot) && (\r\n        <HotspotEditor\r\n          hotspot={selectedHotspot || {}}\r\n          scenes={tour.scenes}\r\n          onSave={handleSaveHotspot}\r\n          onCancel={() => {\r\n            setSelectedHotspot(null);\r\n            setIsAddingHotspot(false);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TourEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}